name: Test Renku-dev release
on:
  repository_dispatch:
    types: [HelmRelease/renku.renku]
jobs:
  run-tests-dev:
    if: ${{ github.event.client_payload.metadata.summary == 'renku-dev' &&
      github.event.client_payload.message == 'Helm test succeeded' }}
    runs-on: ubuntu-20.04
    steps:
      - uses: SwissDataScienceCenter/renku-actions/test-renku@v1.1.0
        with:
          kubeconfig: ${{ secrets.RENKUBOT_DEV_KUBECONFIG }}
          renku-release: renku
          gitlab-token: ${{ secrets.DEV_GITLAB_TOKEN }}
          persist: true
          s3-results-access-key: ${{ secrets.ACCEPTANCE_TESTS_BUCKET_ACCESS_KEY }}
          s3-results-secret-key: ${{ secrets.ACCEPTANCE_TESTS_BUCKET_SECRET_KEY }}
          test-timeout-mins: "80"
